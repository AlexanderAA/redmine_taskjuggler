<% #encoding: utf-8 %>

<h2><%= l(:redmine_taskjuggler)%></h2>

<%= l(:project)%> : <%= @project %> - <%= @project.identifier %>

<p>
<%= submit_tag "Compute in TJ", :type => 'button', :onclick => "javascript:tj3_com()" %>
</p>

<textarea id='placeForText' cols='90' rows='20' disabled></textarea>

<p>
<a href=":8080/taskjuggler"> taskjuggler reports </a>
</p>

<p>
<%= submit_tag "Update CSV", :type => 'button', :onclick => "javascript:html_update()" %>
</p>

<p>Round-trip workflow :
<ol>
  <li><a href="./<%= params[:id] %>/tjp">Export TJP File</a></li>
  <li>Compute in TaskJuggler : <code>$ tj3 <%= @project.identifier.gsub(/-/,"_") %>-<%= @project.tj_version %></code></li>

  <li>See HTML file: <%= 'redmine_update_issues_html_' %><%= @project.identifier.gsub(/-/,"_") %>_<%= @project.tj_version.to_s.gsub(/\./,"_") + ".html" %> </li>

  <li>Update CSV File <%= form_tag('./' + params[:id] + "/csv", :multipart => true) do %>
  <%= file_field_tag 'csvfile', :accept => 'text/csv', :value => @project.identifier + "-" + @project.tj_version.to_s.sub(".","_") + ".csv" %>
  <%= submit_tag %>
<% end %></li>
</ol>

<hr/>
<p style="text-align: center">
<%= l(:redmine_taskjuggler)%> v. <%= RedmineTaskjuggler::Application.instance.version %> (c) 2009 - 2013 Christopher Mann
<a href="https://github.com/chris2fr/redmine_taskjuggler">https://github.com/chris2fr/redmine_taskjuggler</a>
<br/>
<%= l(:taskjuggler)%> (c) 2003 - 2013
 Chris Schlaeger 
<a href="http://www.taskjuggler.org">http://www.taskjuggler.org</a>
<br/>
Redmine (c) 2006-2013 Jean-Philippe Lang <a href="http://www.redmine.org">http://www.redmine.org</a>
<br/>
<i>The glass for Free and Open-Source project management software solutions that go together like cookies and milk!</i>
</p>


<script type="text/javascript">
function tj3_com(){

	<% #name_file = "#{@project.identifier.gsub(/-/,'_')}" + '-' + "#{@project.tj_version.to_s.gsub(/\./,'_')}"  + '.tjp' %>
	<% #name_proj = "#{@project.identifier.gsub(/-/,'_')}" %>
	<% #name_csvrep = 'redmine_update_issues_csv_'+ "#{@project.identifier.gsub(/-/,'_')}" + '_' + "#{@project.tj_version.to_s.gsub(/\./,'_')}" %>
	<% #name_htmlrep = 'redmine_update_issues_html_'+ "#{@project.identifier.gsub(/-/,'_')}" + '_' + "#{@project.tj_version.to_s.gsub(/\./,'_')}" %>

	<% #Dir.chdir "/home/kitsune/tj3web-test/" %>
	<% #outp1 = IO.popen("tj3client add #{name_file}"){|tj3_io| tj3_result = tj3_io.read} %>

	document.getElementById('placeForText').innerHTML=document.getElementById('some_doing').innerHTML

	<% #IO.popen("tj3client report #{name_proj} #{name_htmlrep}") %>
	<% #IO.popen("tj3client report #{name_proj} #{name_csvrep}") %>

	<% #f = IO.readlines("tj3d.log") %>
	<% #outp2 = f[-1] %>

}
</script>

<script type="text/template" id="some_doing">

  <%#= outp2 %>

  <%#= outp1 %>
  
</script>


